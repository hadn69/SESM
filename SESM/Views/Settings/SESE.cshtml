@using System.Web.UI.WebControls
@{
    ViewBag.Title = "SE Server Extender Settings";

    List<KeyValuePair<string, string>> breadCrumb = new List<KeyValuePair<string, string>>();
    breadCrumb.Add(new KeyValuePair<string, string>("Global Setting", "/Settings/"));
    breadCrumb.Add(new KeyValuePair<string, string>("SE Server Extender Settings", "/Settings/SESE/"));
    ViewBag.Breadcrumb = breadCrumb;

    ViewBag.RefreshBtn = true;
}
<div class="col-md-12">
    <div class="portlet light" id="loading-SESE">
        <div class="portlet-body text-center">
            <h4 class="text-center"><i class="fa fa-spin fa-spinner fa-3x"></i></h4>
        </div>
    </div>
</div>
<div class="col-md-12" id="Status-SESE" style="display:none;">
    <div class="alert alert-danger text-center">
        <h1>Something went wrong !</h1>
    </div>
</div>
<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12" id="Local-SESE" style="display:none;">
    <div class="dashboard-stat blue-madison">
        <div class="visual">
            <i class="fa fa-database"></i>
        </div>
        <div class="details">
            <div class="number">
                0.0.0.0
            </div>
            <div class="desc">
                Local Version
            </div>
        </div>
    </div>
</div>
<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12" id="remote-SESE" style="display:none;">
    <div class="dashboard-stat blue-madison">
        <div class="visual">
            <i class="fa fa-globe"></i>
        </div>
        <div class="details">
            <div class="number">
                0.0.0.0
            </div>
            <div class="desc">
                Online Version
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    function initPage() {
        var animationDelay = 0;
        function showViewSESE() {
            $("#loading-SESE").hide(animationDelay);
            $("#Status-SESE").show(animationDelay);
            $("#Local-SESE").show(animationDelay);
            $("#remote-SESE").show(animationDelay);
        }
        function refresh() {
            $("#loading-SESE").show(animationDelay);
            $("#Status-SESE").hide(animationDelay);
            $("#Local-SESE").hide(animationDelay);
            $("#remote-SESE").hide(animationDelay);

            $.get("/API/Settings/GetSESEVersion",
                {},
                function (data, status) {
                    if (status != "success") {
                        toastr.error("See console for more infos", "Fatal Error");
                        Console.warn("Fatal Error : ");
                        Console.warn("Status : " + status);
                        Console.warn("Data : " + data);
                        showViewSESE();
                        return;
                    }

                    var root = $($.parseXML(data)).find("Response");

                    if (root.children("Type").text() == "Error") {
                        toastr.error(root.children("Content").text(), "Error " + root.children("ReturnCode").text());
                        showViewSESE();
                        return;
                    }
                    $("#Status-SESE").children(".alert")
                        .removeClass("alert-success")
                        .removeClass("alert-info")
                        .removeClass("alert-danger")
                        .removeClass("alert-warning");
                    $("#Local-SESE").find(".number").last().html(root.children("Content").children("Local").text());
                    $("#remote-SESE").find(".number").last().html(root.children("Content").children("Remote").text());
                    if (root.children("Content").children("Local").text() == "0.0.0.0") {
                        $("#Status-SESE").find("h1").html("SE Server Extender is not installed");
                        $("#Status-SESE").find(".alert").addClass("alert-info");
                        $("#Local-SESE").find(".number").last().html("N/A");
                        showViewSESE();
                        return;
                    }
                    if (root.children("Content").children("Diff").text() < 0) {
                        $("#Status-SESE").find("h1").html("An update is available !");
                        $("#Status-SESE").children(".alert").addClass("alert-warning");
                    }
                    else if (root.children("Content").children("Diff").text() == 0) {
                        $("#Status-SESE").find("h1").html("SE Server Extender is up to date !");
                        $("#Status-SESE").children(".alert").addClass("alert-success");
                    }
                    else if (root.children("Content").children("Diff").text() > 0) {
                        $("#Status-SESE").find("h1").html("You are more up-to-date than the update feed !<br/>(Are you from the future ?)");
                        $("#Status-SESE").children(".alert").addClass("alert-danger");
                    }

                    showViewSESE();
                    return;
                });
        }

        refresh();
        $("#btnRefresh").click(function() {
            refresh();
        });
    }
</script>
