@using System.Web.UI.WebControls
@{
    ViewBag.Title = "SE Server Extender Settings";

    List<KeyValuePair<string, string>> breadCrumb = new List<KeyValuePair<string, string>>();
    breadCrumb.Add(new KeyValuePair<string, string>("Global Setting", "/Settings/"));
    breadCrumb.Add(new KeyValuePair<string, string>("SE Server Extender Settings", "/Settings/SESE/"));
    ViewBag.Breadcrumb = breadCrumb;

    ViewBag.RefreshBtn = true;
}
<div class="col-md-12">
    <div class="portlet light" id="loading-SESE">
        <div class="portlet-body text-center">
            <h4 class="text-center"><i class="fa fa-spin fa-spinner fa-3x"></i></h4>
        </div>
    </div>
</div>
<div class="col-md-6" style="display:none;" id="StatusPanel">
    <div class="row">
        <div class="col-md-12" id="Status-SESE">
            <div class="alert alert-danger text-center">
                <h3>Something went wrong !</h3>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12" id="Local-SESE">
            <div class="dashboard-stat blue-madison">
                <div class="visual">
                    <i class="fa fa-database"></i>
                </div>
                <div class="details">
                    <div class="number">
                        0.0.0.0
                    </div>
                    <div class="desc">
                        Local Version
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-12" id="remote-SESE">
            <div class="dashboard-stat blue-madison">
                <div class="visual">
                    <i class="fa fa-globe"></i>
                </div>
                <div class="details">
                    <div class="number">
                        0.0.0.0
                    </div>
                    <div class="desc">
                        Online Version
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="col-md-6" style="display:none;" id="SettingsPanel">
    <div class="portlet light bordered">
        <div class="portlet-body form">
            <!-- BEGIN FORM-->
            <form action="#" class="form-horizontal">
                <div class="form-body">
                    <div class="alert alert-danger display-hide" id="validationAlert">
                        <button class="close" data-close="alert"></button>
                        You have some errors. Please check below.
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label">Github URL</label>
                        <div class="col-md-8">
                            <div class="input-group">
                                <span class="input-group-addon">
                                    <i class="fa fa-github"></i>
                                </span>
                                <div class="input-icon right">
                                    <input type="text" class="form-control" placeholder="URL" id="inpGithubURL">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label">Branch</label>
                        <div class="col-md-8 center-block">
                            <input type="checkbox" id="inpDev" class="make-switch" data-on-text="&nbsp;Dev&nbsp;&nbsp;" data-off-text="&nbsp;Release&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label">Auto-Update</label>
                        <div class="col-md-8 center-block">
                            <input type="checkbox" id="inpAutoUpdate" class="make-switch" data-on-text="&nbsp;Enabled&nbsp;&nbsp;" data-off-text="&nbsp;Disabled&nbsp;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label">Auto-Update Cron</label>
                        <div class="col-md-8">
                            <div class="input-group">
                                <span class="input-group-addon">
                                    <i class="fa fa-clock-o"></i>
                                </span>
                                <div class="input-icon right">
                                    <input type="email" class="form-control" placeholder="Ex : 0 0 * * * ?" id="inpCron">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <div class="row">
                        <div class="col-md-offset-4 col-md-8">
                            <button type="button" class="btn blue" id="btnUpdate">Update</button>
                        </div>
                    </div>
                </div>
            </form>
            <!-- END FORM-->
        </div>
    </div>
</div>
<script type="text/javascript">
    function initPage() {
        var animationDelay = 0;
        var statusLoaded = false;
        var settingsLoaded = false;
        function showViewSESE() {
            if (statusLoaded && settingsLoaded) {
                $("#loading-SESE").hide(animationDelay);
                $("#StatusPanel").show(animationDelay);
                $("#SettingsPanel").show(animationDelay);
            }
        }
        function refresh() {
            $("#loading-SESE").show(animationDelay);
            $("#StatusPanel").hide(animationDelay);
            $("#SettingsPanel").hide(animationDelay);

            $.get("/API/Settings/GetSESEVersion",
                {},
                function (data, status) {
                    statusLoaded = true;
                    if (status != "success") {
                        toastr.error("See console for more infos", "Fatal Error");
                        Console.warn("Fatal Error : ");
                        Console.warn("Status : " + status);
                        Console.warn("Data : " + data);
                        showViewSESE();
                        return;
                    }

                    var root = $($.parseXML(data)).find("Response");

                    if (root.children("Type").text() == "Error") {
                        toastr.error(root.children("Content").text(), "Error " + root.children("ReturnCode").text());
                        showViewSESE();
                        return;
                    }
                    $("#Status-SESE").children(".alert")
                        .removeClass("alert-success")
                        .removeClass("alert-info")
                        .removeClass("alert-danger")
                        .removeClass("alert-warning");
                    $("#Local-SESE").find(".number").last().html(root.children("Content").children("Local").text());
                    $("#remote-SESE").find(".number").last().html(root.children("Content").children("Remote").text());
                    if (root.children("Content").children("Local").text() == "0.0.0.0") {
                        $("#Status-SESE").find("h3").html("SE Server Extender is not installed");
                        $("#Status-SESE").find(".alert").addClass("alert-info");
                        $("#Local-SESE").find(".number").last().html("N/A");
                        showViewSESE();
                        return;
                    }
                    if (root.children("Content").children("Diff").text() < 0) {
                        $("#Status-SESE").find("h3").html("An update is available !");
                        $("#Status-SESE").children(".alert").addClass("alert-warning");
                    }
                    else if (root.children("Content").children("Diff").text() == 0) {
                        $("#Status-SESE").find("h3").html("SE Server Extender is up to date !");
                        $("#Status-SESE").children(".alert").addClass("alert-success");
                    }
                    else if (root.children("Content").children("Diff").text() > 0) {
                        $("#Status-SESE").find("h3").html("You are more up-to-date than the update feed !<br/>(Are you from the future ?)");
                        $("#Status-SESE").children(".alert").addClass("alert-danger");
                    }

                    showViewSESE();
                    return;
                });

            $.post("/API/Settings/GetSESESettings",
                {},
                function (data, status) {
                    statusLoaded = true;
                    if (status != "success") {
                        toastr.error("See console for more infos", "Fatal Error");
                        Console.warn("Fatal Error : ");
                        Console.warn("Status : " + status);
                        Console.warn("Data : " + data);
                        showViewSESE();
                        return;
                    }

                    var root = $($.parseXML(data)).find("Response");

                    if (root.children("Type").text() == "Error") {
                        toastr.error(root.children("Content").text(), "Error " + root.children("ReturnCode").text());
                        showViewSESE();
                        return;
                    }
            });
        }

        refresh();
        $("#btnRefresh").click(function () {
            refresh();
        });
    }
</script>
